# Agents ドキュメント

## 設計ドキュメント（第二世代 v2）

222 の設計観点を経て再構築。シンプルさと堅牢性を追求。

```
┌─────────────────────────────────────────────────────────┐
│  10_philosophy.md       設計哲学（変わらない原則）       │
│  「Agent = 設定 + ループ + 判定」                       │
├─────────────────────────────────────────────────────────┤
│  11_core_architecture.md  コアアーキテクチャ（構造）     │
│  三フェーズ: 設定 → 実行 → 判定                         │
├─────────────────────────────────────────────────────────┤
│  12_contracts.md        契約（境界の約束）               │
│  入力・出力・副作用・エラー                              │
├─────────────────────────────────────────────────────────┤
│  13_extension_points.md  拡張ポイント（組み合わせ）      │
│  設定・差し替え・組み合わせ                              │
└─────────────────────────────────────────────────────────┘
```

### 読み方

| 対象       | 推奨順序             |
| ---------- | -------------------- |
| 新規参加者 | 10 → 11 → 実装コード |
| 実装者     | 12 → 11 → 実装コード |
| 拡張者     | 13 → 12 → 実装コード |

## 思考実験の記録

設計の穴を発見するための思考実験。合計 222 観点。

| 実験    | 焦点               | 発見数 | 累計 |
| ------- | ------------------ | ------ | ---- |
| Gecko   | 基本ループ         | 26     | 26   |
| Rudder  | ステップ遷移       | 38     | 64   |
| Saucier | 並列実行（除外）   | 46     | 110  |
| Welder  | 複数インスタンス   | 100    | 210  |
| Tailor  | ステップ間引き継ぎ | 12     | 222  |

### 主要な発見

- **Gecko**: ループは単純に保つ
- **Rudder**: 遷移ロジックを Agent から分離
- **Saucier**: 並列実行は Agent の責務外
- **Welder**: 1 Issue = 1 Branch = 1 Worktree = 1 Instance
- **Tailor**: ステップ出力は名前空間で衝突を防止

## 補助ドキュメント

実装詳細や移行ガイド。

| ファイル                     | 内容              | 状態 |
| ---------------------------- | ----------------- | ---- |
| `02_agent_definition.md`     | agent.json の詳細 | 有効 |
| `03_runner.md`               | Runner 実装詳細   | 有効 |
| `05_prompt_system.md`        | プロンプト解決    | 有効 |
| `06_action_system.md`        | アクション処理    | 有効 |
| `07_config_system.md`        | 設定システム      | 有効 |
| `08_implementation_guide.md` | 実装ガイド        | 有効 |

## 旧ドキュメント（参考）

第二世代で置き換えられた旧設計。互換性確認用。

| ファイル                       | 置換先               |
| ------------------------------ | -------------------- |
| `00_abstraction_layers.md`     | 11_core_architecture |
| `04_design_contracts.md`       | 12_contracts         |
| `09_implementation_details.md` | 実装コード参照       |

## 設計原則（抜粋）

1. **単純さ**: Agent を複雑にしない。必要なら分割。
2. **境界**: Agent の責務は明確な境界内。境界外は委譲。
3. **透明性**: 状態と副作用を明示。暗黙を排除。

## 禁止事項（抜粋）

- Agent 内並列実行
- リソースロック
- 暗黙のデフォルト
- 複雑なブランチ戦略
- ステップ間の暗黙参照

# Agents ドキュメント

## 設計ドキュメント（第二世代 v2）

222 の設計観点を経て再構築。シンプルさと堅牢性を追求。

```
┌─────────────────────────────────────────────────────────┐
│  10_philosophy.md       設計哲学（変わらない原則）       │
│  「Agent = 設定 + ループ + 判定」                       │
├─────────────────────────────────────────────────────────┤
│  11_core_architecture.md  コアアーキテクチャ（構造）     │
│  二つの世界: 内側（Agent）と外側（外部）               │
├─────────────────────────────────────────────────────────┤
│  12_contracts.md        契約（境界の約束）               │
│  入力・出力・副作用・エラー                              │
├─────────────────────────────────────────────────────────┤
│  13_extension_points.md  拡張ポイント（組み合わせ）      │
│  設定・差し替え・組み合わせ                              │
└─────────────────────────────────────────────────────────┘
```

### 読み方

| 対象       | 推奨順序             |
| ---------- | -------------------- |
| 新規参加者 | 10 → 11 → 実装コード |
| 実装者     | 12 → 11 → 実装コード |
| 拡張者     | 13 → 12 → 実装コード |

## 実装ドキュメント

設計を具体化したドキュメント。

| ファイル                 | 内容                 |
| ------------------------ | -------------------- |
| `02_agent_definition.md` | agent.json スキーマ  |
| `03_runner.md`           | Runner の契約と構造  |
| `05_prompt_system.md`    | C3L プロンプト解決   |
| `06_action_system.md`    | アクション検出・実行 |
| `07_config_system.md`    | 設定の階層とマージ   |

## 拡張ドキュメント

特殊なユースケース向け。

| ファイル              | 内容                           |
| --------------------- | ------------------------------ |
| `step_flow_design.md` | ステップフロー（複数フェーズ） |

## 移行ドキュメント

既存 Agent の移行用。

| ファイル                         | 内容           |
| -------------------------------- | -------------- |
| `migration_guide.md`             | 移行ガイド     |
| `migration_template.md`          | 移行リクエスト |
| `migration_incompatibilities.md` | 互換性レポート |

## 思考実験の記録

設計の穴を発見するための思考実験。合計 222 観点。

| 実験    | 焦点               | 発見数 | 累計 |
| ------- | ------------------ | ------ | ---- |
| Gecko   | 基本ループ         | 26     | 26   |
| Rudder  | ステップ遷移       | 38     | 64   |
| Saucier | 並列実行（除外）   | 46     | 110  |
| Welder  | 複数インスタンス   | 100    | 210  |
| Tailor  | ステップ間引き継ぎ | 12     | 222  |

### 主要な発見

- **Gecko**: ループは単純に保つ
- **Rudder**: 遷移ロジックを Agent から分離
- **Saucier**: 並列実行は Agent の責務外
- **Welder**: 1 Issue = 1 Branch = 1 Worktree = 1 Instance
- **Tailor**: ステップ出力は名前空間で衝突を防止

## 設計原則（抜粋）

1. **単純さ**: Agent を複雑にしない。必要なら分割。
2. **境界**: Agent の責務は明確な境界内。境界外は委譲。
3. **透明性**: 状態と副作用を明示。暗黙を排除。

## 禁止事項（抜粋）

- Agent 内並列実行
- リソースロック
- 暗黙のデフォルト
- 複雑なブランチ戦略
- ステップ間の暗黙参照

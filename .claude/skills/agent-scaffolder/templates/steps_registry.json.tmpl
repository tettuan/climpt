{
  "$schema": "../../agents/schemas/steps_registry.schema.json",
  "agentId": "{{AGENT_NAME}}",
  "version": "1.0.0",
  "userPromptsBase": ".agent/{{AGENT_NAME}}/prompts",
  "schemasBase": ".agent/{{AGENT_NAME}}/schemas",

  "c1": "steps",
  "pathTemplate": "{c1}/{c2}/{c3}/f_{edition}.md",

  "entryStepMapping": {
    "issue": "initial.default",
    "default": "initial.default",
    "stepMachine": "initial.default"
  },

  "steps": {
    "initial.default": {
      "stepId": "initial.default",
      "name": "Initial Prompt",
      "c2": "initial",
      "c3": "default",
      "edition": "default",
      "fallbackKey": "default_initial",
      "outputSchemaRef": {
        "file": "step_outputs.schema.json",
        "schema": "#/definitions/initial.default"
      },
      "structuredGate": {
        "allowedIntents": ["next", "repeat", "complete"],
        "intentField": "next_action.action",
        "fallbackIntent": "next",
        "handoffFields": ["analysis", "plan"]
      },
      "transitions": {
        "next": { "target": "continuation.default" },
        "repeat": { "target": "initial.default" },
        "complete": { "target": "complete.default" }
      }
    },
    "continuation.default": {
      "stepId": "continuation.default",
      "name": "Continuation Prompt",
      "c2": "continuation",
      "c3": "default",
      "edition": "default",
      "outputSchemaRef": {
        "file": "step_outputs.schema.json",
        "schema": "#/definitions/continuation.default"
      },
      "structuredGate": {
        "allowedIntents": ["next", "repeat", "complete"],
        "intentField": "next_action.action",
        "fallbackIntent": "next",
        "handoffFields": ["progress"]
      },
      "transitions": {
        "next": { "target": "continuation.default" },
        "repeat": { "target": "continuation.default" },
        "complete": { "target": "complete.default" }
      }
    },
    "complete.default": {
      "stepId": "complete.default",
      "name": "Completion Step",
      "c2": "complete",
      "c3": "default",
      "edition": "default",
      "outputSchemaRef": {
        "file": "step_outputs.schema.json",
        "schema": "#/definitions/complete.default"
      },
      "structuredGate": {
        "allowedIntents": ["complete"],
        "intentField": "next_action.action",
        "fallbackIntent": "complete",
        "handoffFields": ["final_summary"]
      },
      "transitions": {
        "complete": { "target": null }
      }
    }
  }
}
